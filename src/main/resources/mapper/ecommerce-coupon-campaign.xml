<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jojo.ecommerce.adapter.out.persistence.CouponCampaignMapper">

    <resultMap id="CampaignResult" type="com.jojo.ecommerce.domain.model.CouponCampaign">
        <id column="campaign_id"   property="campaignId"/>
        <result column="total_count"   property="totalCount"/>
        <result column="issued_count"  property="issuedCount"/>
    </resultMap>

    <select id="selectCampaignById" resultMap="CampaignResult" parameterType="long">
        SELECT
            campaign_id
          , total_count
          , issued_count
        FROM coupon_campaign
        WHERE campaign_id = #{campaignId}
    </select>

    <insert id="insertCampaign" parameterType="com.jojo.ecommerce.domain.model.CouponCampaign" useGeneratedKeys="true" keyProperty="campaignId">
        INSERT INTO coupon_campaign (
            total_count
          , issued_count
          , reg_date
        ) VALUES (
            #{totalCount}
          , #{issuedCount}
          , NOW()
        )
    </insert>

    <update id="updateCampaign">
        UPDATE coupon_campaign
        SET issued_count = #{issuedCount},
            upd_date     = NOW()
        WHERE campaign_id  = #{campaignId}
    </update>
</mapper>
